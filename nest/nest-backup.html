<!DOCTYPE html>
<body lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <!--标题栏-->
    <title>template</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="../lib/jquery-3.3.1/jquery-3.1.1.min.js"></script>
    <script src="../lib/materialize-0.97.8/js/materialize.min.js"></script>
    <link rel="stylesheet" href="../lib/materialize-0.97.8/css/materialize.min.css"/>
    <script src="../lib/d3-4.7.1/d3.min.js"></script>
    <style type="text/css">
        body {
            background: gray;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <svg class="col s12 m12 l12 grey lighten-5 z-depth-5" id="svg-content" style="height: 800px">
        </svg>
    </div>

</div>
<a class="btn-floating btn-large waves-effect waves-light black" style="bottom:90px;right:23px;position:fixed"
   href="nest-1.html"><i class="material-icons">replay</i></a>

<!--侧边栏-->
<ul id="slide-out" class="side-nav z-depth-5">
    <li>
        <div class="container"><img class="responsive-img" src="../img/logo.png" style="margin: 25px 0"></div>
    </li>
    <li>
        <div class="container">
            <div class="input-field">
                <select id="select-language" onchange="selected_lang()">
                    <option value="zh-cn" selected>简体中文</option>
                    <option value="en">English</option>
                </select>
            </div>
        </div>
    </li>
    <li>
        <div class="divider"></div>
    </li>
    <li>
        <div class="container"><span id="text-catalog"></span></div>
    </li>
    <li id="catalog">
        <!--侧边栏内部折叠目录-->
        <!--修改json-->
        <ul class="collapsible" data-collapsible="accordion"></ul>
    </li>
</ul>
<!--底部按钮-->

<div class="fixed-action-btn toolbar">
    <a class="btn-floating btn-large cyan">
        <i class="large material-icons">menu</i>
    </a>
    <ul>
        <li class="waves-effect waves-light"><a href="../" class="tooltipped" id="text-tooltip-home"><i
                class="material-icons">view_carousel</i></a></li>
        <li class="waves-effect waves-light"><a href="#!" class="tooltipped button-collapse" data-activates="slide-out"
                                                id="text-tooltip-sidenav" data-position="top" data-delay="50"><i
                class="material-icons">pageview</i></a></li>
        <li class="waves-effect waves-light"><a href="#info-modal" class="tooltipped" id="text-tooltip-info"
                                                data-position="top" data-delay="50"><i
                class="material-icons">info</i></a></li>
        <li class="waves-effect waves-light"><a href="#help-modal" class="tooltipped" id="text-tooltip-help"
                                                data-position="top" data-delay="50"><i
                class="material-icons">live_help</i></a></li>
    </ul>
</div>
<!--信息及帮助-->
<div id="info-modal" class="modal blue lighten-3">
    <div class="modal-content">
        <h4 id="text-modal-info"></h4>
        <div id="text-nest-1-info"></div>
    </div>
    <div class="modal-footer">
        <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat text-next"></a>
    </div>
</div>
<div id="help-modal" class="modal orange lighten-3">
    <div class="modal-content">
        <h4 id="text-modal-help"></h4>
        <div id="text-nest-1-help"></div>
    </div>
    <div class="modal-footer">
        <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat text-yes"></a>
    </div>
</div>
<!--注意：涉及页面文本的修改要到json里面改-->
<script type="text/javascript">
    /**
     * 控制侧边栏
     */
    $(".button-collapse").sideNav({
        draggable: true
    });
    var isopen = true;
    function switchnav() {
        if (isopen) {
            isopen = false;
            $(".button-collapse").sideNav("show");
        }
        else {
            isopen = true;
            $(".button-collapse").sideNav("hide");
        }
    }
    /**
     * 控制多语言及文本
     */
    var lang;
    var isinitial = true;
    var fib_0_intro;
    var next;
    $(document).ready(function () {
        $('select').material_select();
    });
    var txt = document.cookie.split(";");
    lang = $("#select-language").find("option:selected").val();
    var textjson;
    for (var i = 0; i < txt.length; i++) {
        if (txt[i].match("\{.*\}")) {
            lang = JSON.parse(txt[i]).lang;
        }
    }
    function catalog_id(sect, exam) {
        return "s" + sect + "e" + exam + "id";
    }
    function selected_lang() {
        if (!isinitial) {
            lang = $("#select-language").find("option:selected").val();
        } else isinitial = false;
        $.getJSON("../text/" + lang + ".json", function (data) {
            /**
             * 注意：
             * 每一个文本信息在json中储存后，
             * 都要在如下部分注册，
             * 先后顺序不产生影响。
             */
            textjson = data;
            $("#text-catalog").html(data.catalog);
            $("#text-tooltip-sidenav").attr("data-tooltip", data.tooltip_sidenav);
            $("#text-tooltip-help").attr("data-tooltip", data.tooltip_help);
            $("#text-tooltip-info").attr("data-tooltip", data.tooltip_info);
            $("#text-tooltip-home").attr("data-tooltip", data.tooltip_home);
            $(".text-yes").html(data.yes);
            $("#text-modal-info").html(data.modal_info);
            $("#text-modal-help").html(data.modal_help);
            $("#text-nest-1-info").html(data.nest_1_info);
            $("#text-nest-1-help").html(data.nest_1_help);
            $(".text-next").html(data.next);
            document.title = data.nest_1_title;
            /**
             * 到这里结束
             */
            $(document).ready(function () {
                $('.tooltipped').tooltip({delay: 50});
            });
        });
        $.getJSON("../catalog/" + lang + ".json", function (data) {
            $("#catalog .collapsible").remove();
            $("#catalog").append("<ul class='collapsible' data-collapsible='accordion'></ul>");
            var co_wrapper = $("#catalog .collapsible");
            for (var i = 0; i < data.length; i++) {
                var temp_li = co_wrapper.append("<li id='" + catalog_id(i, 0) + "'></li>");
                temp_li.find("#" + catalog_id(i, 0)).append("<div class='collapsible-header'><a class='waves-effect btn-flat' href='" + data[i].href + "'>" + data[i].text + "</a></div>");
                var temp_inner = temp_li.find("#" + catalog_id(i, 0)).append("<div class='collapsible-body'></div>");
                if (data[i].child != undefined) {
                    var temp_colle = temp_inner.find(".collapsible-body").append("<div class='collection'></div>");
                    for (var j = 0; j < data[i].child.length; j++) {
                        temp_colle.find(".collection").append("<a href='" + data[i].child[j].href + "' class='collection-item waves-effect btn-flat'>" + data[i].child[j].text + "</a>");
                    }
                }
            }
            $(document).ready(function () {
                $('.collapsible').collapsible();
            });
        });
        document.cookie = JSON.stringify({"lang": lang});
    }
    selected_lang();
    $(document).ready(function () {
        // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
        $('.modal').modal();
    });
</script>
<script>
    setTimeout(function () {
        $("#info-modal").modal('open');
    }, 100);
    setTimeout(function () {
        $("#info-modal").modal('close');
    }, 2900);
    setTimeout(function () {
        $("#help-modal").modal('open');
    }, 3000);

    setTimeout(function () {
        $.getJSON("../text/" + lang + ".json", function (data) {
            console.log(data.nest_1_toast);
            Materialize.toast(data.nest_1_toast, 5000);
        });
    }, 6000);

    var svg = d3.select("svg");
    var SHeight = Number(svg.attr("height"));
    var SWidth = Number(svg.attr("width"));
    var nodes = [{"id": "Jack", "x": 1, "y": 4},
        {"id": "Sam", "x": 2, "y": 8},
        {"id": "Leo", "x": 4, "y": 6},
        {"id": "Susan", "x": 8, "y": 4},
        {"id": "Walt", "x": 9, "y": 7},
        {"id": "Karl", "x": 4, "y": 2}];
    var Link = [{"source": "Jack", "target": "Sam"},
        {"source": "Jack", "target": "Leo"},
        {"source": "Jack", "target": "Susan"},
        {"source": "Jack", "target": "Walt"},
        {"source": "Jack", "target": "Karl"},
        {"source": "Sam", "target": "Leo"},
        {"source": "Sam", "target": "Susan"},
        {"source": "Sam", "target": "Walt"},
        {"source": "Sam", "target": "Karl"},
        {"source": "Leo", "target": "Susan"},
        {"source": "Leo", "target": "Walt"},
        {"source": "Leo", "target": "Karl"},
        {"source": "Susan", "target": "Walt"},
        {"source": "Susan", "target": "Karl"},
        {"source": "Walt", "target": "Karl"}];
    //svg.append("text").attr("x",10).attr("y",30).attr("font-size",30).text("（非正式提示），此模板为六人问题");
    //svg.append("text").attr("y",400).attr("y",60).attr("font-size",10).text("拉姆塞定理示例，六人聚会问题，两人之间只存在朋友与陌生人的关系，则对于任\n意一人来说，认识与不认识的人必定有一种超过两人。");
    var link = svg.selectAll("line").data(Link).enter().append("line");
    var node = svg.selectAll("circle")
        .data(nodes)
        .enter()
        .append("circle")
        .attr("cx", SWidth / 2)
        .attr("cy", SHeight / 2)
        .attr("fill", "#81d4fa")
        .attr("stroke", "#03a9f4")
        .attr("class", function (d, i) {
            return "People_" + d.id;
        })
        .attr("cx", function (d, i) {
            return d.x * 75;
        })
        .attr("cy", function (d, i) {
            return d.y * 75;
        })
        .attr("r", 0);
    /*var simulation=d3.forceSimulation()
                     .force("link",d3.forceLink.id(function(d){return d.id}))
                     .force("charge",d3.forceManyBody())
                     .force("center",d3.forceCenter(SWidth/2,SHeight/2));
    node.call(d3.drag().on("start",dragstarted).on("drag",dragged).on("end",dragended));
    simulation.nodes(nodes).on("tick",ticked);
    simulation.force("link").links(links)
    */
    /*node.call(d3.drag().on("start",function(d) {
     d.fx = d.x;
     d.fy = d.y;
     }).on("drag", function(d) {
     d.fx = d3.event.x;
     d.fy = d3.event.y;
     link.attr("x1", function(ld, i) {
     if (ld.source == d.id) {

     }
     })
     }).on("end", function(d) {
     d.fx = null;
     d.fy = null;
     }));*/
    node
        .transition()
        .duration(1000)
        .attr("r", 30);
    /*var link=svg.selectAll("line").data(Link).enter().append("line").attr("x1",function(d,i){
     return d3.select("circle.People_"+d.source).attr("cx");
     })
     .attr("y1",function(d,i){
     return d3.select("circle.People_"+d.source).attr("cy");
     })
     .attr("x2",function(d,i){
     return d3.select("circle.People_"+d.target).attr("cx");
     })
     .attr("y2",function(d,i){
     return d3.select("circle.People_"+d.target).attr("cy");
     })
     .attr("stroke","#aaa")
     .attr("stroke-width",1)
     .attr("z-index",-999);
     */

    link
        .attr("x1", function (d) {
            return d3.select("circle.People_" + d.source).attr("cx");
        })
        .attr("y1", function (d) {
            return d3.select("circle.People_" + d.source).attr("cy");
        })
        .attr("x2", function (d) {
            return d3.select("circle.People_" + d.target).attr("cx");
        })
        .attr("y2", function (d) {
            return d3.select("circle.People_" + d.target).attr("cy");
        })
        .attr("stroke", "#aaa")
        .attr("stroke-width", 0)
        .attr("id", function (d, i) {
            return "line_" + i;
        })
        .attr("class", function (d, i) {
            return "Source_" + d.source + " " + "Target_" + d.target;
        });
    link
        .transition()
        .duration(1000)
        .attr("stroke-width", 3);
    var text_line = svg.selectAll(".linetext")
        .data(Link)
        .enter()
        .append("text")
        .attr("class", function (d, i) {
            return "text_" + i;
        })
        .attr("x", function (d, i) {
            return (Number(d3.select("circle.People_" + d.source).attr("cx")) + Number(d3.select("circle.People_" + d.target).attr("cx"))) / 2;
        })
        .attr("y", function (d, i) {
            return (Number(d3.select("circle.People_" + d.source).attr("cy")) + Number(d3.select("circle.People_" + d.target).attr("cy"))) / 2;
        })
        .attr("font-size", 0);
    var text_circle = svg.selectAll(".circletext")
        .data(nodes)
        .enter()
        .append("text")
        .attr("class", function (d, i) {
            return "textc_" + i;
        })
        .text(function (d, i) {
            return d.id;
        })
        .attr("x", function (d, i) {
            return d3.select("circle.People_" + d.id).attr("cx");
        })
        .attr("y", function (d, i) {
            return d3.select("circle.People_" + d.id).attr("cy");
        })
        .attr("font-size", 0)
        .attr("fill", "#01579b");


    //圆事件监听器
    d3.selectAll("circle").on("mouseover", function (d, i) {
        d3.select(this).transition().duration(500).attr("r", 40);
        svg.select("text.textc_" + i).transition().duration(500).attr("font-size", 20);
        d3.selectAll("line.Source_" + d.id).transition().duration(500).attr("stroke-width", 6)
        /*.call(function(dl,il){
         d3.selectAll("text.text_"+il).transition().duration().attr("font-size",20);
         })*/;
        d3.selectAll("line.Target_" + d.id).transition().duration(500).attr("stroke-width", 6)/*.call(function(dl,il){
         d3.selectAll("text.text_"+il).transition().duration().attr("font-size",20);
         })*/;
    })
        .on("mouseout", function (d, i) {
            d3.select(this).transition().duration(500).attr("r", 30);
            svg.select("text.textc_" + i).transition().duration(500).attr("font-size", 0);
            d3.selectAll("line.Source_" + d.id).transition().duration(500).attr("stroke-width", 3);
            d3.selectAll("line.Target_" + d.id).transition().duration(500).attr("stroke-width", 3);
        });
    function Random(randomer) {
        for (var i = 0; i < randomer.length; i++) {
            randomer[i] = Math.floor(Math.random() * 2);
        }
        link.transition().duration(1000).attr("stroke", function (d, i) {
                if (randomer[i] == 1)return "#ff1744";
                if (randomer[i] == 0)return "#03a9f4";
            }
        ).attr("stroke-width", 3);
    }
    var randomer = new Array(Link.length);
    Random(randomer);
    text_line.text(function (d, i) {
        if (randomer[i] == 1) return "Friends";
        if (randomer[i] == 0) return "Strangers";
    })
    //线事件监听器
    d3.selectAll("line").on("mouseover", function (d, i) {
        d3.select(this).transition().duration(500).attr("stroke-width", 6);
        d3.select("text.text_" + i).attr("font-size", 20);
    })
        .on("mouseout", function (d, i) {
            if (randomer[i] == 1)
                d3.select(this).transition().duration(500).attr("stroke", "#ff1744").attr("stroke-width", 3);
            if (randomer[i] == 0)
                d3.select(this).transition().duration(500).attr("stroke", "#03a9f4").attr("stroke-width", 3);
            d3.select("text.text_" + i).attr("font-size", 0);
        });


    //示例测试
    /*var simulation=d3.forceSimulation()
                    .force("link",d3.forceLink().id(function(d){ return d.id}).distance(200))
                    .force("charge",d3.forceManyBody())
                    .force("center",d3.forceCenter(SWidth/2,SHeight/2));
     simulation.nodes(nodes).on("tick",ticked);
     simulation.force("link").links(Link);     
     node.call(d3.drag()
     . on("start",dragstarted)
     .on("drag",dragged)
     .on("end",dragended));          
function ticked(){
    link.
    attr("x1",function(d){return d.source.x;})
    .attr("y1",function(d){return d.source.y;})
    .attr("x2",function(d){return d.target.x;})
    .attr("y",function(d){return d.target.y;})
    node.
    attr("cx",function(d){return d.x;})
    .attr("cy",function(d){return d.y;});
}
function dragstarted(d){
    if(!d3.event.active)simulation.alphaTarget(0.3).restart();
    d.fx=d.x;
    d.fy=d.y;
}
function dragged(d){
    d.fx=d3.event.x;
    d.fy=d3.event.y;
}
function dragended(d){
    if(!d3.event.active)simulation.alphaTarget(0);
    d.fx=null;
    d.fy=null;
}*/
</script>
<script>


</script>
</body>